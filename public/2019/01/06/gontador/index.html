<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gontador - Blog by sahli.net - Philip Sahli</title>
  <meta name="author" content="Philip Sahli">
  <meta name="description" content="A blog about everything.">

  <meta name="generator" content="Hugo 0.55.5" />

  
  
  
  
  
  <link rel="stylesheet" href="/assets/css/external.min.css" media="screen">

  
  
  <link rel="stylesheet" href="/assets/css/styles.css" media="screen">

  <link href="//fonts.googleapis.com/css?family=Roboto:400" rel="stylesheet">

  
  
  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/src/images/apple-touch-icon.png">
  <link rel="shortcut icon" href="/src/images/favicon.ico">

  
  <link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="Blog by sahli.net - Philip Sahli" />
  <link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="Blog by sahli.net - Philip Sahli" />

  <meta property="og:title" content="Gontador" />
<meta property="og:description" content="Gontador
An einem I2 Standortmeeting hat Laurent Bovet eindrücklich aufgezeigt, wie ein einfacher Service in NodeJs implementiert und für den Betrieb auf Openshift “fit” gemacht wird.
https://github.com/lbovet/contador
Contador ist ein Service, der bei jedem HTTP GET-Request in Redis einen Counter um 1 erhöht und der neue Wert in der HTTP-Response dem Client überträgt. Laurent hat verschiedene notwendige Aspekte in Commits implementiert.
 Logging mit TraceId https://github.com/lbovet/contador/commit/e7c4b282aa416ac9528ab324d810698354a9a3b1 Applikation muss auf ein SIGHUP reagieren und ein “graceful shutdown” machen." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.sahli.net/2019/01/06/gontador/" />
<meta property="article:published_time" content="2019-01-06T12:17:01&#43;02:00"/>
<meta property="article:modified_time" content="2019-01-06T12:17:01&#43;02:00"/>

  
  
<meta itemprop="name" content="Gontador">
<meta itemprop="description" content="Gontador
An einem I2 Standortmeeting hat Laurent Bovet eindrücklich aufgezeigt, wie ein einfacher Service in NodeJs implementiert und für den Betrieb auf Openshift “fit” gemacht wird.
https://github.com/lbovet/contador
Contador ist ein Service, der bei jedem HTTP GET-Request in Redis einen Counter um 1 erhöht und der neue Wert in der HTTP-Response dem Client überträgt. Laurent hat verschiedene notwendige Aspekte in Commits implementiert.
 Logging mit TraceId https://github.com/lbovet/contador/commit/e7c4b282aa416ac9528ab324d810698354a9a3b1 Applikation muss auf ein SIGHUP reagieren und ein “graceful shutdown” machen.">


<meta itemprop="datePublished" content="2019-01-06T12:17:01&#43;02:00" />
<meta itemprop="dateModified" content="2019-01-06T12:17:01&#43;02:00" />
<meta itemprop="wordCount" content="482">



<meta itemprop="keywords" content="typography,elements," />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Gontador"/>
<meta name="twitter:description" content="Gontador
An einem I2 Standortmeeting hat Laurent Bovet eindrücklich aufgezeigt, wie ein einfacher Service in NodeJs implementiert und für den Betrieb auf Openshift “fit” gemacht wird.
https://github.com/lbovet/contador
Contador ist ein Service, der bei jedem HTTP GET-Request in Redis einen Counter um 1 erhöht und der neue Wert in der HTTP-Response dem Client überträgt. Laurent hat verschiedene notwendige Aspekte in Commits implementiert.
 Logging mit TraceId https://github.com/lbovet/contador/commit/e7c4b282aa416ac9528ab324d810698354a9a3b1 Applikation muss auf ein SIGHUP reagieren und ein “graceful shutdown” machen."/>

</head>

  <body>
    
      <nav>
  <a href="/" title="Homepage">
    blog.sahli.net
  </a>
</nav>

    
    <main class="container">
      
  <article>
    <header>
      <small>
        <time datetime="2019-01-06 12:17:01&#43;0200">2019-01-06</time>
        &bull;
          
            
            <a href="/categories/writing">WRITING</a>
          
            , 
            <a href="/categories/golang">GOLANG</a>
          </small>
      <h1>Gontador</h1>
    </header>
    <section><p>Gontador</p>

<p>An einem I2 Standortmeeting hat Laurent Bovet eindrücklich aufgezeigt, wie ein einfacher Service in NodeJs implementiert und für den Betrieb auf Openshift “fit” gemacht wird.</p>

<p><a href="https://github.com/lbovet/contador">https://github.com/lbovet/contador</a></p>

<p>Contador ist ein Service, der bei jedem HTTP GET-Request in Redis einen Counter um 1 erhöht und der neue Wert in der HTTP-Response dem Client überträgt. Laurent hat verschiedene notwendige Aspekte in Commits implementiert.</p>

<ul>
<li>Logging mit TraceId <a href="https://github.com/lbovet/contador/commit/e7c4b282aa416ac9528ab324d810698354a9a3b1">https://github.com/lbovet/contador/commit/e7c4b282aa416ac9528ab324d810698354a9a3b1</a></li>
<li>Applikation muss auf ein SIGHUP reagieren und ein “graceful shutdown” machen. Während einer bestimmten Zeit werden die offenen Requests noch fertig bearbeitet und beantwortet. <a href="https://github.com/lbovet/contador/commit/0aa8c7c741481d837d20e5f58bf7a96daef00138">https://github.com/lbovet/contador/commit/0aa8c7c741481d837d20e5f58bf7a96daef00138</a></li>
<li>Behandeln von “Readiness” und “Liveness” Anfragen <a href="https://github.com/lbovet/contador/commit/5db408f07f6f36745c8586c4c61aaa4809dc8d67">https://github.com/lbovet/contador/commit/5db408f07f6f36745c8586c4c61aaa4809dc8d67</a>  Readiness dient dazu, dass Kubernetes den Pod erst mit Requests bedient, wenn er ready ist. Liveness um nicht funktionierende Pod’s nicht zu bedienen und zu ersetzen.</li>
<li>Senden von Metriken an Telegraf, welcher die Daten an Grafana weiterleitet.</li>
</ul>

<p>Contador ist mit NodeJs implementiert und verwendet das Web-Framework “Express”.</p>

<p>Beim Durcharbeiten einiger Abschnitte des Kurses &ldquo;Go: The Complete Developer&rsquo;s Guide (Golang)&rdquo; hatte ich den Drang zu praktischer Arbeit mit Go gespürt und bin auf die Idee gekommen, Laurent&rsquo;s Contador in Go zu implementieren. Daraus wurde meine persönliche Challenge:</p>

<p>Meine Challenge</p>

<ul>
<li>Bin ich nach einem Udemy-Kurs in der Lage, einen (sehr einfachen) Service in Go zu implementieren?</li>
<li>Existieren Libraries für die in Contador verwendeten Funktionalitäten?</li>
<li>Kann die Post-Toolchain auch für Go eingesetzt werden?</li>
</ul>

<p>Was ist Go</p>

<p>Go eignet sich für:
* Microservices, z.b. aufgrund der Effizienz und des kleinen RAM-Fussabdrucks. (siehe <a href="https://medium.com/@craigchilds94/go-for-php-developer-getting-started-14e817eb82de">https://medium.com/@craigchilds94/go-for-php-developer-getting-started-14e817eb82de</a>)
* Command Line Interfaces, z.b. wegen der Portabilität (<code>go build</code> erzeugt eine ausführbare Datei pro Zielplattform). Auf der Zielplattform muss keine Laufzeitumgebung, keine Pakete oder Bibliotheken installiert werden.</p>

<p>Bei der Implementierung bin ich über folgende Libraries und Lösungen gestossen:</p>

<ul>
<li>Mux als Web-Framework</li>
<li>Logging Konfiguration</li>
<li>Type-safe Redis client for Golang <a href="https://github.com/go-redis/redis">https://github.com/go-redis/redis</a></li>

<li><p>Dependency Management mittels go-dep <a href="https://github.com/golang/dep In">https://github.com/golang/dep In</a> Go werden abhängige Pakete von ihrer Source aus einem Repository heruntergeladen (z.b. go get -u github.com/gorilla/mux). Zur Buildzeit werden alle verwendeten Pakete gebuildet und gecached. Somit können geforkte Repositories ohne grossen Zusatzaufwand verwendet werden. Wollen wir etwas am Paket gorilla/mux ändern, klont man das Repo gorilla/mux nach philipsahli/mux und macht die gewünschten Änderungen. Damit der dann auch wirklich diesen Fork verwendet, müssen wir ein Constraint in Gopkg.toml eintragen:</p>

<p>[[constraint]]
   name = &ldquo;github.com/gorilla/mux”
   branch = “master”
   source = &ldquo;github.com/philipsahli/mux”</p></li>

<li><p>Build Prozess mittels “Multi-stage builds” <a href="https://github.com/philipsahli/gontador/blob/go-implementation/Dockerfile">https://github.com/philipsahli/gontador/blob/go-implementation/Dockerfile</a>  In einem Dockerfile werden mehrere Base-Images verwendet (Pro stage eine <code>FROM</code> Instruktion), von Stage zu einem anderen Stages können z.b. Artefakte kopiert werden. In unserem Fall wird im golang-Dockerimage das Programm gebuildet und dann in ein schlankes alpine-Image kopiert, was zu einem sehr schlanken Dockerimage führt und wir uns nicht um Aufräumarbeiten (Entfernen von Compiler, Source etc.) kümmern müssen.</p></li>
</ul>

<p><a href="https://github.com/philipsahli/gontador">https://github.com/philipsahli/gontador</a></p>

<p>Fazit</p>

<p>In Go zu programmieren macht Spass und scheint einfach zu sein. Vorallem der rasche Einstieg erstaunt mich und motiviert mich, den Gontador zu erweitern.</p>

<p>Was kommt als nächstes:</p>

<ul>
<li><p>Gonsumidor Gonsumidor kommuniziert über gRPC mit Gontador</p></li>

<li><p>Goperador Mehrere Kubernetes-integrierte Counters: Operator Pattern mit Operator SDK <a href="https://github.com/operator-framework/operator-sdk">https://github.com/operator-framework/operator-sdk</a></p></li>
</ul>
</section>
    <footer>
      <hr>
      <div class="meta">
        <p class="tags">
          
            
              <a href="/tags/typography">
                <span>#</span>typography</a>
            
              <a href="/tags/elements">
                <span>#</span>elements</a>
            
          
        </p>
      </div>
      <hr>
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "test" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>
  </article>

    </main>
    
      <footer>
  <p>
    &copy; 2020 Philip Sahli. <a href="http://creativecommons.org/licenses/by-sa/4.0/">Some Rights Reserved</a>.
  </p>
  <p>
    Powered by <a href="https://gohugo.io" title="A Fast and Flexible Website Generator">Hugo</a> &amp; <a href="https://github.com/eshlox/simplicity" title="Hugo theme">Simplicity</a>.
  </p>
</footer>

    
    
    
    
    
    
    
    <script src="/assets/js/scripts.min.js"></script>
    
  </body>
</html>
